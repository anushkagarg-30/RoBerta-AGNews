HPC Setup
https://ood.hpc.nyu.edu/ (OOD for Greene Node)

> ssh ns6287@greene.hpc.nyu.edu

[ns6287@log-1 ~]$ ssh burst

--------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------
On Burst Node
[ns6287@log-burst ~]$ srun --account=ece_gy_7123-2025sp --partition=n1s8-v100-1 --gres=gpu:1 --time=04:00:00 --pty /bin/bash

[ns6287@log-burst ~]$ srun --account=ece_gy_7123-2025sp --partition=interactive --time=04:00:00 --pty /bin/bash

[ns6287@log-burst ~]$ watch squeue --me


bash-5.1$ cd /scratch/ns6287
bash-5.1$ mkdir robertalora
bash-5.1$ cd robertalora/

bash-5.1$ ls /scratch/work/public/overlay-fs-ext3

bash-5.1$ scp greene-dtn:/scratch/work/public/overlay-fs-ext3/overlay-15GB-500K.ext3.gz .
bash-5.1$ gunzip -vvv ./overlay-15GB-500K.ext3.gz

bash-5.1$ scp -rp greene-dtn:/scratch/work/public/singularity/cuda11.8.86-cudnn8.7-devel-ubuntu22.04.2.sif .

bash-5.1$ singularity exec --bind /scratch --nv --overlay  /scratch/ns6287/robertalora/overlay-15GB-500K.ext3:rw /scratch/ns6287/robertalora/cuda11.8.86-cudnn8.7-devel-ubuntu22.04.2.sif /bin/bash

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Inside Singularity
Singularity> cd /ext3/

Singularity> wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh

Singularity> bash ./Miniconda3-latest-Linux-x86_64.sh -b -p /ext3/miniconda3

Singularity> rm Miniconda3-latest-Linux-x86_64.sh

Singularity> nano /ext3/env.sh
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#!/bin/bash

unset -f which

source /ext3/miniconda3/etc/profile.d/conda.sh
export PATH=/ext3/miniconda3/bin:$PATH
export PYTHONPATH=/ext3/miniconda3/bin:$PATH
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Singularity> source /ext3/env.sh

Singularity> conda update -n base conda -y
Singularity> conda clean --all --yes
Singularity> conda install pip --yes
Singularity> conda install ipykernel --yes # Note: ipykernel is required to run as a kernel inthe Open OnDemand Jupyter Notebooks

Singularity> pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
Singularity> pip3 install jupyter jupyterhub pandas matplotlib scipy scikit-learn scikit-image Pillow

Singularity> python (robertalora)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> import torch
>>> torch.cuda.is_available()
>>> exit()
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Singularity> exit (Exiting Singularity)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


bash-5.1$ vim torch-test.py
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#!/bin/env python

import torch

print(torch.__file__)
print(torch.__version__)

# How many GPUs are there?
print(torch.cuda.device_count())

# Get the name of the current GPU
print(torch.cuda.get_device_name(torch.cuda.current_device()))

# Is PyTorch using a GPU?
print(torch.cuda.is_available())
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


bash-5.1$ vim run-test.sbatch
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#!/bin/bash

#SBATCH --job-name=torch_robertalora
#SBATCH --account=ece_gy_7123-2025sp
#SBATCH --partition=n1s8-v100-1
#SBATCH --output=%x.out
#SBATCH --error=%x.err
#SBATCH --export=ALL
#SBATCH --time=00:10:00
#SBATCH --mem=2GB
#SBATCH --gres=gpu:1
#SBATCH --requeue

module purge

singularity exec --nv \
	    --overlay /scratch/ns6287/robertalora/overlay-15GB-500K.ext3:ro \
	    /scratch/ns6287/robertalora/cuda11.8.86-cudnn8.7-devel-ubuntu22.04.2.sif\
	    /bin/bash -c "source /ext3/env.sh; python torch-test.py"
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

bash-5.1$ sbatch run-test.sbatch
bash-5.1$ squeue -u ns6287










